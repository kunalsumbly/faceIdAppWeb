<!Doctype html>
<html>

<head>
    <title>FaceId App</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.734.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/webcamjs/1.0.26/webcam.js"></script>
    <script src="../faceid-app-web/js/faceid.js"></script>
    <style>
       #results{
           width: 400px;
           height: 400px;
       }

    </style>

</head>

<body>
    <!-- Container Start  -->
    <div class="container">
       
        <!-- Signup Form -->
        <div id="signup">
            <form>
                <fieldset>
                    <legend>
                        <h2>Capture Image here!!!</h2>
                    </legend>
                     
                    <div id="webcam"></div>
                    <div id="results"></div>

                    <div class="buttons">
                        <!--input type="file" value="Capture Image" id="uploadInput" accept="image/png, image/jpeg ;" /-->
                        <input type="button" value="Capture Image" onclick="takePicture();"/>
                    </div>
                </fieldset>
            </form>

        </div>

        
    <!-- Container End -->
    <script>
        function  uploadImageToS3Bucket() {
            console.log(s3);
            // list bucket objects 
            s3.listObjects(function(err,data) {
                if(err) {
                    console.log(err, err.stack);
                } else {
                    console.log(data);
                }
            });

            // put object
            const file = this.files[0];
            console.log(file);
            var params = {
                Body: file, 
                Bucket: bucketName, 
                Key: file.name
            };
            
            s3.putObject(params, function(err, data) {
                if (err) console.log(err, err.stack); // an error occurred
                else     console.log(data);           // successful response
            
            });


        }

        function takePicture(){
           
            // take the snap shot and display the image in another div
            Webcam.snap( function(data_uri) {
                //console.log(data_uri);
            // display results in page
                var d = new Date();
                document.getElementById('results').innerHTML = '<img src="'+data_uri+'"/>';
                var v_blob = b64toBlob(data_uri);
                var params = {
                Body: v_blob, 
                Bucket: bucketName, 
                Key: "img_"+d.getTime()+".jpeg"
             };
            
            s3.putObject(params, function(err, data) {
                if (err) console.log(err, err.stack); // an error occurred
                else  {   
                    console.log(data);           // successful response
                }
            
            });
            } );
        }

       Webcam.set({
                width: 320,
                height: 240,
                image_format: 'jpeg',
                jpeg_quality: 90
            });

            // attach the webcam to the div
            Webcam.attach( '#webcam' );

        // below code attaches s3 upload function whenever a file is uploaded
        //document.getElementById("uploadInput").addEventListener("change", uploadImageToS3Bucket, false);

        // this function converts base64 image to blob which is used to actually upload to s3 bucket
        function b64toBlob(dataURI) {
                var byteString = atob(dataURI.split(',')[1]);
                var ab = new ArrayBuffer(byteString.length);
                var ia = new Uint8Array(ab);

                for (var i = 0; i < byteString.length; i++) {
                    ia[i] = byteString.charCodeAt(i);
                }
                return new Blob([ab], { type: 'image/jpeg' });
        }
    </script>
</body>

</html>